<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leave Application Form - Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .form-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2563eb;
            margin-bottom: 30px;
        }
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group {
            flex: 1;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #374151;
            font-weight: 500;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 5px;
            font-size: 14px;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 5px rgba(37, 99, 235, 0.3);
        }
        .readonly {
            background-color: #f9fafb;
            color: #6b7280;
        }
        .submit-btn {
            background-color: #2563eb;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        }
        .submit-btn:hover {
            background-color: #1d4ed8;
        }
        .note {
            background-color: #fef3c7;
            border: 1px solid #f59e0b;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            color: #92400e;
        }
        .user-selector {
            background-color: #e0f2fe;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .success {
            background-color: #d1fae5;
            border: 1px solid #10b981;
            color: #065f46;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .error {
            background-color: #fee2e2;
            border: 1px solid #ef4444;
            color: #991b1b;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .auto-calculated {
            background-color: #e0f2fe !important;
            border-color: #0ea5e9 !important;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <h1>üèñÔ∏è Leave Application Form</h1>
        
        <!-- Demo User Selection -->
        <div class="user-selector">
            <label><strong>Select Employee (for demo):</strong></label>
            <select id="userSelect" onchange="loadEmployeeData()">
                <option value="1">Juan Dela Cruz (HR Department)</option>
                <option value="2">Crystal Anne Barayang (HR Department)</option>
                <option value="3">Rain Sy (HR Department)</option>
                <option value="4">Allen Ararao (Accounting Department)</option>
                <option value="5">Lala Dump (IT Department)</option>
                <option value="6" selected>Crystal Anne Alcantara (Accounting Department)</option>
            </select>
            <button onclick="loadEmployeeData()" style="margin-left: 10px; padding: 5px 10px;">Load Data</button>
        </div>

        <div id="messages"></div>

        <form id="leaveForm" onsubmit="submitLeaveRequest(event)">
            <div class="form-row">
                <div class="form-group">
                    <label for="company">Company</label>
                    <input type="text" id="company" name="company" readonly class="readonly">
                </div>
                <div class="form-group">
                    <label for="dateFiled">Date Filed</label>
                    <input type="date" id="dateFiled" name="dateFiled" readonly class="readonly">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="employeeName">Name</label>
                    <input type="text" id="employeeName" name="employeeName" readonly class="readonly">
                </div>
                <div class="form-group">
                    <label for="department">Department</label>
                    <input type="text" id="department" name="department" readonly class="readonly">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="leaveType">Leave Type</label>
                    <select id="leaveType" name="type" required onchange="calculateDays()">
                        <option value="">Select Leave Type</option>
                        <option value="Vacation Leave">Vacation Leave</option>
                        <option value="Sick Leave">Sick Leave</option>
                        <option value="Emergency Leave">Emergency Leave</option>
                        <option value="Maternity Leave">Maternity Leave</option>
                        <option value="Paternity Leave">Paternity Leave</option>
                        <option value="Personal Leave">Personal Leave</option>
                        <option value="Bereavement Leave">Bereavement Leave</option>
                    </select>
                </div>
            </div>

            <div class="note">
                <strong>Note:</strong> Pay terms and leave category will be determined by HR during the approval process.
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="fromDate">From Date</label>
                    <input type="date" id="fromDate" name="from" required onchange="calculateDays()">
                </div>
                <div class="form-group">
                    <label for="toDate">To Date</label>
                    <input type="date" id="toDate" name="to" required onchange="calculateDays()">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="totalDays">Total Days</label>
                    <input type="number" id="totalDays" name="total_days" readonly class="auto-calculated" min="1">
                </div>
                <div class="form-group">
                    <label for="totalHours">Total Hours (if partial day)</label>
                    <input type="number" id="totalHours" name="total_hours" min="0" max="8" step="0.5" placeholder="Optional">
                </div>
            </div>

            <div class="form-group">
                <label for="reason">Reason</label>
                <textarea id="reason" name="reason" rows="4" required minlength="10" maxlength="500" 
                          placeholder="Please provide a detailed reason for your leave (minimum 10 characters)"></textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="signature">Digital Signature</label>
                    <input type="file" id="signature" name="signature" accept=".pdf,.jpg,.jpeg,.png,.gif">
                </div>
                <div class="form-group">
                    <label for="attachment">Supporting Documents</label>
                    <input type="file" id="attachment" name="attachment" accept=".pdf,.jpg,.jpeg,.png">
                </div>
            </div>

            <button type="submit" class="submit-btn">Submit Leave Request</button>
        </form>
    </div>

    <script>
        // Set today's date as filed date
        document.getElementById('dateFiled').value = new Date().toISOString().split('T')[0];
        
        // Set minimum date for leave request (tomorrow)
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        document.getElementById('fromDate').min = tomorrow.toISOString().split('T')[0];
        
        function showMessage(message, type = 'success') {
            const messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML = `<div class="${type}">${message}</div>`;
            setTimeout(() => {
                messagesDiv.innerHTML = '';
            }, 5000);
        }

        async function loadEmployeeData() {
            const userId = document.getElementById('userSelect').value;
            
            try {
                showMessage('Loading employee data...', 'success');
                
                const response = await fetch(`http://localhost:8000/api/employee-profile-test/${userId}`);
                const data = await response.json();
                
                if (response.ok) {
                    // Auto-populate form fields
                    document.getElementById('company').value = data.company;
                    document.getElementById('employeeName').value = data.employee_name;
                    document.getElementById('department').value = data.department;
                    
                    showMessage(`Employee data loaded successfully! Welcome ${data.employee_name} from ${data.department}`, 'success');
                } else {
                    showMessage(`Error: ${data.error || 'Failed to load employee data'}`, 'error');
                }
            } catch (error) {
                console.error('Error loading employee data:', error);
                showMessage('Failed to connect to server. Please ensure the Laravel server is running.', 'error');
            }
        }

        function calculateDays() {
            const fromDate = document.getElementById('fromDate').value;
            const toDate = document.getElementById('toDate').value;
            
            if (fromDate && toDate) {
                const start = new Date(fromDate);
                const end = new Date(toDate);
                
                if (end >= start) {
                    const diffTime = Math.abs(end - start);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
                    document.getElementById('totalDays').value = diffDays;
                } else {
                    document.getElementById('totalDays').value = '';
                    showMessage('To date must be after from date', 'error');
                }
            }
        }

        async function submitLeaveRequest(event) {
            event.preventDefault();
            
            const formData = new FormData(document.getElementById('leaveForm'));
            
            // Basic validation
            const reason = formData.get('reason');
            if (reason.length < 10) {
                showMessage('Reason must be at least 10 characters long', 'error');
                return;
            }
            
            try {
                showMessage('Submitting leave request...', 'success');
                
                const response = await fetch('http://localhost:8000/api/leave-requests', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showMessage('Leave request submitted successfully! üéâ', 'success');
                    // Optionally clear form or redirect
                    document.getElementById('leaveForm').reset();
                    loadEmployeeData(); // Reload employee data
                } else {
                    const errors = result.errors ? 
                        Object.values(result.errors).flat().join(', ') : 
                        (result.error || 'Failed to submit leave request');
                    showMessage(`Error: ${errors}`, 'error');
                }
            } catch (error) {
                console.error('Error submitting leave request:', error);
                showMessage('Failed to submit leave request. Please try again.', 'error');
            }
        }

        // Load initial employee data
        loadEmployeeData();
    </script>
</body>
</html>
